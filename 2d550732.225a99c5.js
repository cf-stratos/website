(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{119:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return b}));var a=n(2),i=n(6),r=(n(0),n(354)),o={title:"Kubernetes Endpoints",sidebar_label:"Kubernetes"},c={unversionedId:"endpoints/k8s",id:"endpoints/k8s",isDocsHomePage:!1,title:"Kubernetes Endpoints",description:"Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications",source:"@site/docs/endpoints/k8s.md",permalink:"/docs/next/endpoints/k8s",editUrl:"https://github.com/cloudfoundry/stratos/edit/master/website/docs/endpoints/k8s.md",version:"next",sidebar_label:"Kubernetes",sidebar:"docs",previous:{title:"Configuring Invite User Support",permalink:"/docs/next/endpoints/cf/invite-user-guide"},next:{title:"Stratos Metrics Endpoints",permalink:"/docs/next/endpoints/metrics/metrics"}},s=[{value:"Registering a Kubernetes Endpoint",id:"registering-a-kubernetes-endpoint",children:[]},{value:"Connecting a Kubernetes Endpoint",id:"connecting-a-kubernetes-endpoint",children:[{value:"Certificate based authentication",id:"certificate-based-authentication",children:[]},{value:"Username and password based authentication",id:"username-and-password-based-authentication",children:[]},{value:"CAASP (OIDC)",id:"caasp-oidc",children:[]},{value:"Amazon EKS",id:"amazon-eks",children:[]},{value:"Azure AKS",id:"azure-aks",children:[]}]},{value:"For a quick way to registered all endpoints",id:"for-a-quick-way-to-registered-all-endpoints",children:[]}],l={rightToc:s};function b(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/"}),"Kubernetes")," (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications"),Object(r.b)("p",null,"Stratos provides easy access to Kubernetes features such as"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Browsing Kubernetes resources and their state"),Object(r.b)("li",{parentName:"ol"},"Terminal with kubectl (and helm) CLI tools (Tech Preview)"),Object(r.b)("li",{parentName:"ol"},"Run Security Observability Tools (Tech Preview)"),Object(r.b)("li",{parentName:"ol"},"Browsing Kubernetes Workloads"),Object(r.b)("li",{parentName:"ol"},"The Kubernetes Dashboard (Tech Preview)")),Object(r.b)("p",null,"Adding a Stratos Helm Endpoint alongside a Kubernetes endpoint unlocks additional features"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Install a Helm chart into the kubernetes"),Object(r.b)("li",{parentName:"ol"},"Upgrade new or existing Helm charts")),Object(r.b)("h2",{id:"registering-a-kubernetes-endpoint"},"Registering a Kubernetes Endpoint"),Object(r.b)("p",null,"Stratos Administrator's can register endpoints via the Endpoints page."),Object(r.b)("p",null,"Usually all that's needed is the Kubernetes API address, as well as a friendly name to identify the endpoint in Stratos."),Object(r.b)("p",null,"Some basic information for finding the endpoint address for specific kubernetes clusters can be found bellow in the connecting section."),Object(r.b)("h2",{id:"connecting-a-kubernetes-endpoint"},"Connecting a Kubernetes Endpoint"),Object(r.b)("p",null,"Stratos supports a number of different ways to authenticate with your Kubernetes cluster. There are a few generic ways that cover many types of clusters, but also authentication methods specific to some providers."),Object(r.b)("p",null,"The currently supported connection methods and types of cluster are:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Certificate based Kubernetes authentication"),Object(r.b)("li",{parentName:"ol"},"Username and password based Kubernetes authentication"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.suse.com/products/caas-platform/"}),"SUSE CaaSP")," (OIDC)"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://aws.amazon.com/eks/"}),"AWS EKS")," (AWS IAM auth)"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://azure.microsoft.com/en-gb/services/kubernetes-service/"}),"Azure AKS")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://k3s.io/"}),"K3S"))),Object(r.b)("h3",{id:"certificate-based-authentication"},"Certificate based authentication"),Object(r.b)("p",null,"Some kubernetes clusters use TLS certificates for authentication. The following example shows how to register and connect to one of these called ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://minikube.sigs.k8s.io/docs/"}),"Minikube"),"."),Object(r.b)("p",null,"To find the Minikube endpoint URL, locate the ",Object(r.b)("inlineCode",{parentName:"p"},"minikube")," entry in your local ",Object(r.b)("inlineCode",{parentName:"p"},"kubeconfig")," file. In the following example, the ",Object(r.b)("inlineCode",{parentName:"p"},"minikube")," endpoint URL is ",Object(r.b)("inlineCode",{parentName:"p"},"https://192.168.99.100:8443"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"- cluster:\n    certificate-authority: /home/user/.minikube/ca.crt\n    server: https://192.168.99.100:8443\n  name: minikube\n")),Object(r.b)("p",null,"To connect to the cluster, locate the relevant entry in the ",Object(r.b)("inlineCode",{parentName:"p"},"users")," section in your kubernetes config file."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"users:\n- name: minikube\n  user:\n    client-certificate: /home/user/.minikube/client.crt\n    client-key: /home/user/.minikube/client.key\n\n")),Object(r.b)("p",null,"The two files specified under ",Object(r.b)("inlineCode",{parentName:"p"},"client-certificate")," and ",Object(r.b)("inlineCode",{parentName:"p"},"client-key")," are required to connect to the cluster.\nSelect the ",Object(r.b)("inlineCode",{parentName:"p"},"Kubernetes Cert Auth")," option as the Auth Type in the connect dialog and select the two files to connect."),Object(r.b)("h3",{id:"username-and-password-based-authentication"},"Username and password based authentication"),Object(r.b)("p",null,"To connect using a username and password simply select the ",Object(r.b)("inlineCode",{parentName:"p"},"Username and Password")," option as the Auth Type in the connect dialog."),Object(r.b)("h3",{id:"caasp-oidc"},"CAASP (OIDC)"),Object(r.b)("p",null,"To connect a CAASP cluster to Stratos, download a ",Object(r.b)("inlineCode",{parentName:"p"},"kubeconfig")," from Velum."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"To find the endpoint URL, inspect the file. The ",Object(r.b)("inlineCode",{parentName:"li"},"server")," property details the endpoint URL")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"apiVersion: v1\nkind: Config\nclusters:\n- name: caasp\n  cluster:\n    server: https://kube-api-x1.devenv.caasp.suse.net:6443 <---Endpoint URL\n    certificate-authority-data: 1c1MFpYSnVZV3dnUTBFd0hoY05NVGd4TURBMU1USXhNalU1V2hjTk1qZ3hNREF5TVRJeE1qVTVXakNCb1RFTApNQWtHQTFVRUJoTUNSRVV4RURBT0JnTlZCQWdNQjBKaGRtRnlhV0V4RWpBUUJnTlZCQWNNQ1U1MWNtVnRZbVZ5Clp6RWJNQmtHQTFVRUNnd1NVMVZUUlNCQmRYUnZaMl...\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Specify the Endpoint URL when adding the endpoint to Stratos."),Object(r.b)("li",{parentName:"ol"},"To connect to Kubernetes, select the ",Object(r.b)("inlineCode",{parentName:"li"},"CAASP (OIDC)")," option as the Auth Type, and upload the ",Object(r.b)("inlineCode",{parentName:"li"},"kubeconfig")," file downloaded from Velum.")),Object(r.b)("h3",{id:"amazon-eks"},"Amazon EKS"),Object(r.b)("p",null,"To Connect the following details are required:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Cluster Name (See the following example)"),Object(r.b)("li",{parentName:"ul"},"AWS Access Key"),Object(r.b)("li",{parentName:"ul"},"AWS Secret Key")),Object(r.b)("h4",{id:"eks-endpoint-url-and-cluster-name"},"EKS Endpoint URL And Cluster Name"),Object(r.b)("p",null,"You can locate the EKS cluster endpoint URL and the cluster name, by inspecting the generated cluster configuration in your local ",Object(r.b)("inlineCode",{parentName:"p"},"kubeconfig"),". "),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"10:20 $ cat ~/.kube/config \n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa...QXR2N3dOQkt3eFhsYgpxZm5HRUs0WHRmSWNIcjJHSjhZOXdIa0lPRm0rR3Nvak1PaG1pK05wbER2YjVJc3BmMmxxbXdLd3RmRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n    server: https://40BCD34B7E297903DA2EAF19B6164521.sk1.us-east-1.eks.amazonaws.com\n  name: arn:aws:eks:us-east-1:138384977974:cluster/BRSSCF\n\n")),Object(r.b)("p",null,"The endpoint URL is specified in the ",Object(r.b)("inlineCode",{parentName:"p"},"server")," property (i.e. ",Object(r.b)("inlineCode",{parentName:"p"},"https://40BCD34B7E297903DA2EAF19B6164521.sk1.us-east-1.eks.amazonaws.com"),"), while the cluster name is the last part of the ",Object(r.b)("inlineCode",{parentName:"p"},"name")," property (i.e ",Object(r.b)("inlineCode",{parentName:"p"},"BRSSCF"),")."),Object(r.b)("h3",{id:"azure-aks"},"Azure AKS"),Object(r.b)("p",null,"To connect an AKS kubernetes instance, the following is required:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"AKS Endpoint URL, which can be found from the AKS console or the generated kubernetes configuration."),Object(r.b)("li",{parentName:"ol"},"To connect to the cluster, provide the ",Object(r.b)("inlineCode",{parentName:"li"},"kubeconfig")," file.")),Object(r.b)("h2",{id:"for-a-quick-way-to-registered-all-endpoints"},"For a quick way to registered all endpoints"),Object(r.b)("p",null,"For a quick way to register kubernetes endpoints and in some cases also connect, the user can select ",Object(r.b)("inlineCode",{parentName:"p"},"Import Kubeconfig")," instead of the\nendpoint types listed above. Once the user has provided the file they can then select which contexts to register and, if applicable, how to connect to it. Not all connection types are supported this way, for instance where files are reference in config. These can still be registered, and via the Endpoints page connected to, just not connected at that time."))}b.isMDXComponent=!0},354:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),b=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=b(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=b(n),d=a,m=p["".concat(o,".").concat(d)]||p[d]||u[d]||r;return n?i.a.createElement(m,c(c({ref:t},l),{},{components:n})):i.a.createElement(m,c({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var l=2;l<r;l++)o[l]=n[l];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);